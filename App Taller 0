import java.util.*;
import java.io.*;
public class App {

	public static void main(String[] args) throws IOException {
		//clientes.txt
		String[] Nombres = new String[100];
		String[] Apellidos = new String[100];
		String[] Ruts = new String[100];
		String[] Claves = new String[100];
		double[] Saldos = new double[100];
		int[] c_Entradas = new int[100];
		String[] asientos = new String[100];
		// para guardar las entradas de la persna String[] Entradas = new String[100];
		//status.txt
		String[] Ruts1 = new String[100];
		String[] Estado = new String[100];
		//Listas y matriz peliculas.txt
		String[] Nombres_peli = new String[100];
		String[] Tipos = new String[100];
		double[] Recaudaciones = new double[100];
		String[] infoPeliculas = new String[100];
		
		String[][] salas = new String[3][4];
		
		for(int i=0; i<4;i++) {
			salas[0][i] = i+"\t";
		}
		salas[1][0]= "M\t";
		salas[2][0]="T\t";
		
		//Recaudaciones Agregada Diego 29/9
		int [] Dia_R = new int[100];
		int [] Mañana_R = new int[100];
		int [] Tarde_R = new int [100];
		

		
		int cantClientes = leerClientes(Nombres, Apellidos, Ruts, Claves, Saldos, c_Entradas, asientos);
		int cantStatus = LeerStatus(Ruts1, Estado);
		int cantPeliculas = LeerPeliculas(Nombres_peli, Tipos, Recaudaciones, salas, infoPeliculas);
		
		 //Matrices salas de cine (mañana y tarde), filas A-D 20 asientos (1-5 y 26-30 sin asientos), filas E-J 30 asientos
        String [][] Sala1M = new String [11][31];
        String [][] Sala1T = new String [11][31];
        String [][] Sala2M = new String [11][31];
        String [][] Sala2T = new String [11][31];
        String [][] Sala3M = new String [11][31];
        String [][] Sala3T = new String [11][31];
        
        rellenarMatriz(Sala1M);
        rellenarMatriz(Sala1T);
        rellenarMatriz(Sala2M);
        rellenarMatriz(Sala2T);
        rellenarMatriz(Sala3M);
        rellenarMatriz(Sala3T);
        
        //Comienzo de datos
        String res="";
        while(!res.equals("3")) {
        	System.out.println("Bienvenidos al Cine de Cuevana");
        	System.out.print("Ingrese su Rut: ");
        	String rut = scan.next();
        	System.out.print("Ingrese su Contraseña: ");
        	String clave = scan.next();
        	
        	
        	if(rut.equals("ADMIN") && clave.equals("ADMIN")) {
        		//Agregada Diego 29/9
        		res = MenuAdmin(Nombres, Apellidos, Ruts, Claves, Saldos,Ruts1,
        				Estado,Nombres_peli,Tipos,Recaudaciones,infoPeliculas, salas, 
        				Sala1M, Sala2M, Sala3M, Sala1T, Sala2T,Sala3T, cantPeliculas, c_Entradas, asientos, rut, cantClientes
        				,Dia_R,Mañana_R,Tarde_R);
        		break;
        	}else {
        		rut = convertirRut(rut);
        		if(verificarCliente(rut, cantClientes, Ruts, clave, Claves) == true){
        			res = MenuUsuario(Nombres, Apellidos, Ruts, Claves, Saldos,Ruts1,Estado,Nombres_peli,Tipos,
        					Recaudaciones,infoPeliculas, salas, Sala1M, Sala2M, 
        					Sala3M, Sala1T, Sala2T,Sala3T, cantPeliculas, c_Entradas, asientos, rut, cantClientes,Dia_R,Mañana_R,Tarde_R);
        		}else {
        			System.out.print("No se encontro el rut o la contraseña era incorrecta. \nDesea volver a intentarlo (1), Registrarse (2) o Cerrar(3): ");
        			res = scan.next();
        			if(res.equals("1")) {
        				res="1";
        			}else if(res.equals("2")){
        				//registrarse
        				break;
        			}else if(res.equals("3")){
        				res="3";
        				//cerrar sistema
        			}else {
        				System.out.print("Se ingreso un rato erroneo");
        			}
        		}
        	}
        }
	}
	//AGREGAR 
	private static String MenuAdmin(String[] Nombres, String[] Apellidos, String[] Ruts, String[] Claves,
			double[] Saldos, String[] Ruts1, String[] Estado, String[] Nombres_peli, String[] Tipos,
			double[] Recaudaciones, String[] infoPeliculas, String[][] salas, String[][] Sala1M, String[][] Sala2M,
			String[][] Sala3M, String[][] Sala1T, String[][] Sala2T, String[][] Sala3T, int cantPeliculas,
			int[] c_Entradas, String[] asientos, String rut, int cantClientes, int[] Dia_R, int[] Mañana_R, int[] Tarde_R) {
		Scanner sca = new Scanner(System.in);
		String res ="";
		int cant = 0;
		System.out.println("Bienvenido al menu de Admin, escoja una opcion: ");
		while(!res.equals("2") && !res.equals("3")) {
			System.out.println("A)Taquilla \nB)Informacion Cliente");
			String res1= sca.next().toUpperCase();
			if(res1.equals("A")) {
				System.out.println(res=Taquilla(Nombres, Apellidos, Ruts, Claves, Saldos,Ruts1,
        				Estado,Nombres_peli,Tipos,Recaudaciones,infoPeliculas, salas, 
        				Sala1M, Sala2M, Sala3M, Sala1T, Sala2T,Sala3T, cantPeliculas, c_Entradas, asientos, rut, cantClientes
        				,Dia_R,Mañana_R,Tarde_R));
				
			}else if (res1.equals("B")) {
				
			}else {
				System.out.println("No se eligio una opcion correcta");	
			}
			
		}
		
		
		
		return res;
	}
	//MENU ADMIN A 
	private static String Taquilla(String[] Nombres, String[] Apellidos, String[] Ruts, String[] Claves,
			double[] Saldos, String[] Ruts1, String[] Estado, String[] Nombres_peli, String[] Tipos,
			double[] Recaudaciones, String[] infoPeliculas, String[][] salas, String[][] Sala1M, String[][] Sala2M,
			String[][] Sala3M, String[][] Sala1T, String[][] Sala2T, String[][] Sala3T, int cantPeliculas,
			int[] c_Entradas, String[] asientos, String rut, int cantClientes, int[] Dia_R, int[] Mañana_R, int[] Tarde_R) {
		
		String res = "";
		for (int i = 0; i < cantPeliculas;i++) {
			res += "\nNombre de la Pelicula: "+Nombres_peli[i]+"\n -Monto Recaudado Total: "+Recaudaciones[i]+
					"\n -Monto Recaudado en el Dia: "+ Dia_R[i]+"\n -Monto Recaudado en la Mañana:"+Mañana_R[i]+
					"\n -Monto Recaudado en la Tarde: "+Tarde_R[i] +"\n";
			
			
		}
		return res;
	}
	//Agregar int[] Dia_R, int[] Mañana_R, int[] Tarde_R
	private static String MenuUsuario(String[] nombres, String[] apellidos, String[] ruts, String[] claves,
			double[] saldos, String[] ruts1, String[] estado, String[] nombres_peli, String[] tipos,
			double[] recaudaciones, String[] infoPeliculas, String[][] salas, String[][] sala1m, String[][] sala2m,
			String[][] sala3m, String[][] sala1t, String[][] sala2t, String[][] sala3t, int cantPeliculas, int[] c_Entradas,
			String[] asientos, String rut, int cantClientes,int[] Dia_R, int[] Mañana_R, int[] Tarde_R) {
		Scanner sca = new Scanner(System.in);
		String res="";
		int cant=0;
		String[][] sala= new String[11][31];
		
		//res 1 (volver a mostrar las opciones) res 2(salir al menu principal) res 3 cerrar sistema
		//se repite dos veces el bienvenido
		//revisar el comprar entradas
		
		System.out.println("Bienvenido al Menu de Usuario, escoja la opcion:");
		while(!res.equals("2") && !res.equals("3")) {
			System.out.println("A)Comprar entrada \nB)Informacion Usuario \nC)Devolucion entrada \nD)Cartelera");
			String res1 = scan.next().toUpperCase();
			
			if(res1.equals("A")) {
				for(int k=0;k<cantPeliculas;k++) {
					System.out.println("Pelicula "+nombres_peli[k]);
				}
				System.out.println("Ingrese el nombre de la pelicula: ");
				String n_pelicula = sca.nextLine(); //error aquiiiii
				for(int i=0; i<cantPeliculas;i++) {
					if(nombres_peli[i].equals(n_pelicula)) {
						System.out.println("Numero de Sala y Horario para la pelicula "+n_pelicula);
						String[] parte = infoPeliculas[i].split(",");
						if(n_pelicula.equals("Rapidos y Furioso")) {
							cant=3;
						}else if(n_pelicula.equals("El conjuro 3")){
							cant=1;
						}else {
							cant=2;
						}
						for(int j=0;j<cant;j++) {
							if(parte[j] != null) {
								System.out.println(parte[j]);
							}
						}
						System.out.print("Eliga la funcion: ");
						String res2=scan.next();
						if(res2.equals("1M")) {
							imprimirMatriz(sala1m,11,31);
							res = comprarEntrada(sala1m, c_Entradas, asientos, nombres_peli, recaudaciones, rut, 
									estado,saldos, ruts,n_pelicula, tipos, cantPeliculas, cantClientes,Dia_R,Mañana_R,Tarde_R,res2);
						}else if(res2.equals("1T")) {
							imprimirMatriz(sala1t,11,31);
							res = comprarEntrada(sala1t, c_Entradas, asientos, nombres_peli, recaudaciones, rut, 
									estado,saldos, ruts,n_pelicula, tipos, cantPeliculas, cantClientes,Dia_R,Mañana_R,Tarde_R,res2);
						}else if(res2.equals("2M")) {
							imprimirMatriz(sala2m,11,31);
							res = comprarEntrada(sala2m, c_Entradas, asientos, nombres_peli, recaudaciones, rut, 
									estado,saldos, ruts,n_pelicula, tipos, cantPeliculas, cantClientes,Dia_R,Mañana_R,Tarde_R,res2);
						}else if(res2.equals("2T")) {
							imprimirMatriz(sala2t,11,31);
							res = comprarEntrada(sala2t, c_Entradas, asientos, nombres_peli, recaudaciones, rut, 
									estado,saldos, ruts,n_pelicula, tipos, cantPeliculas, cantClientes,Dia_R,Mañana_R,Tarde_R,res2);
						}else if(res2.equals("3M")) {
							imprimirMatriz(sala3m,11,31);
							res = comprarEntrada(sala3m, c_Entradas, asientos, nombres_peli, recaudaciones, rut, 
									estado,saldos, ruts,n_pelicula, tipos, cantPeliculas, cantClientes,Dia_R,Mañana_R,Tarde_R,res2);
						}else if(res2.equals("3T")) {
							imprimirMatriz(sala3t,11,31);
							res = comprarEntrada(sala3t, c_Entradas, asientos, nombres_peli, recaudaciones, rut, 
									estado,saldos, ruts,n_pelicula, tipos, cantPeliculas, cantClientes,Dia_R,Mañana_R,Tarde_R,res2);
						}else {
							System.out.println("No se eligio una opcion valida");
						}
					}
				}
				
			}else if(res1.equals("B")) {
				break;
				
			}else if(res1.equals("C")) {
				break;
				
			}else if(res1.equals("D")) {
				for(int i=0; i<cantPeliculas;i++) {
						System.out.println("Numero de Sala y Horario para la pelicula "+nombres_peli[i]+": ");
						String[] parte = infoPeliculas[i].split(",");
						if(nombres_peli[i].equals("Rapido y Furioso")) {
							cant=3;
						}else if(nombres_peli[i].equals("El conjuro 3")){
							cant=1;
						}else {
							cant=2;
						}
						for(int j=0;j<cant;j++) {
							if(parte[j] != null) {
								System.out.println(parte[j]);
							}
						}
				}
				//puede ser una funcion

				System.out.println("Desea realizar otra opcion (1) o salir (2) o cerrar(3)");
				res=scan.next();
			}else {
				System.out.println("No se eligio una opcion correcta");				
			}
		}
		return res;
	}
	//AGREGAR int[] Dia_R, int[] Mañana_R, int[] Tarde_R
	private static String comprarEntrada(String[][] sala, int[] c_Entradas, String[] asientos, 
			String[] nombres_peli, double[] recaudaciones, String rut, String[] estado, 
			double[] saldos, String[] ruts, String n_pelicula, String[] tipos, int cantPeliculas, 
			int cantClientes,int[] Dia_R, int[] Mañana_R, int[] Tarde_R, String res2) {
		System.out.print("Cuantas entradas va a desear: ");
		int cantEntradas = scan.nextInt();
		int cant = cantEntradas;
		double gasto=0;
		//VERIFICAR LAS FILAS Y COLUMNAS COMPRE 3 HORIZONTAL Y 1 VERTICAL
		for(int k=0;k<cantEntradas;k++) {
			System.out.println("Escoga la fila (Horizontal) : ");
			String fila = scan.next().toUpperCase()+"\t";
			
			System.out.println("Escoga la columna (Vertical) : ");
			String columna = scan.next()+"\t";
			
			int n_fila=0;
			int n_columna=0;
			for(int i=0; i<11;i++) {
				if(sala[i][0].equals(fila)) {
					
					n_fila=i;
				}
			}
			for(int j=0;j<31;j++) {
				if(sala[0][j].equals(columna)) {
					n_columna=j;
				}
			}
			//sala[n_fila][n_columna] = "X\t";
			if(n_columna == 0 && n_fila==0) {
				System.out.println("No se encontro el asiento, escoja otro.");
				cantEntradas++;
			}else if(sala[n_fila][n_columna].equals("-\t") || sala[n_fila][n_columna].equals("X\t")) {
				System.out.println("Asiento no disponible, escoja otro.");
				cantEntradas++;
			}else {
				sala[n_fila][n_columna] = "X\t";
				if(n_columna == 1) {
					sala[n_fila][n_columna+1] = "-\t";
				}else if(n_columna == 30) {
					sala[n_fila][n_columna-1] = "-\t";
				}else {
					sala[n_fila][n_columna+1] = "-\t";
					sala[n_fila][n_columna-1] = "-\t";
				}
				
			}
		}
		int posP=0;
		for(int i =0; i<cantPeliculas;i++) {
			if(nombres_peli[i].equals(n_pelicula)) {
				posP=i;
				if(tipos[i].equals("estreno")) {
					gasto = 5500*cant;
				}else {
					gasto=4000*cant;
				}
			}
		}
		int pos = 0;
		for(int i=0; i<cantClientes;i++) {
			if(ruts[i].equals(rut)) {
				c_Entradas[i] +=cant;
				pos=i;
				if(estado[i].equals("HABILITADO")) {
					gasto = (gasto*85)/100;
				}	
			}
		}
		
		String res="";
		//AGREGAR A LAS LISTAS DIA_R,MAÑANA Y TARDE EL GASTO
		while(!res.equals("1") && !res.equals("2")) {
			System.out.println("El total de la compra es $"+gasto);
			System.out.print("Desea confirmar la compra(1) o volver(2): ");
			res=scan.next();
			if(res.equals("1")) {
				if(saldos[pos] > gasto) {
					saldos[pos] -=gasto;
					recaudaciones[posP] +=gasto;
					Dia_R[posP]+=gasto;
					String horario = res2.substring(1);
					System.out.println(horario);
					if(horario.equals("M")){
						Mañana_R[posP]+=gasto;
					}else {
						Tarde_R[posP]+=gasto;
					}
					
					//sumar a la sala
				}else {
					System.out.print("No tiene saldo suficiente\nIngrese el saldo que desee recargar: ");
					double agregado = scan.nextDouble();
					saldos[pos] +=agregado;
					res="3";
				}
			}
		}
		System.out.println("Desea realizar otra opcion (1) o salir (2) o cerrar(3)");
		res=scan.next();
		return res;
	}
	private static boolean verificarCliente(String rut, int cantClientes, String[] Ruts, String clave, String[] Claves) {
		for(int i=0; i<cantClientes; i++) {
			if(Ruts[i].equals(rut) && Claves[i].equals(clave)) {
				return true;
			}
		}
		return false;
	}
	

	private static String convertirRut(String rut) {
		rut=rut.toUpperCase();
		rut=rut.replace(".","");
		rut=rut.replace("-","");
		return rut;
		
	}
	private static void rellenarMatriz(String[][] sala) {
		for(int i =0; i<31;i++) {
			sala[0][i] = +i+"\t";
		}
		sala[1][0] = "A\t";
		sala[2][0] = "B\t";
		sala[3][0] = "C\t";
		sala[4][0] = "D\t";
		sala[5][0] = "E\t";
		sala[6][0] = "F\t";
		sala[7][0] = "G\t";
		sala[8][0] = "H\t";
		sala[9][0] = "I\t";
		sala[10][0] = "J\t";
		
		for(int i=1;i<11;i++) {
			for(int j=1; j<31;j++) {
				
				if(i<5 && j< 6 || i<5 && j>25 && j<31) {
					sala[i][j] = "-\t";
				}else {
					sala[i][j] = "O\t";
					}
				}
			}
		
		}
	private static void imprimirMatriz(String[][] sala, int largo, int ancho) {
		String texto = "";
		for(int i=0; i<largo;i++) {
			for(int j=0; j<ancho;j++) {
				texto += sala[i][j] +" "; 
			}
			System.out.println(texto);
			texto="";
		}
		System.out.println(" ");
	}
	private static int LeerPeliculas(String[] Nombres_peli, String[] Tipos, double[] Recaudaciones, String[][] salas, String[] infoPeliculas) throws IOException {
		BufferedReader arch = new BufferedReader(new FileReader("peliculas.txt"));
		String linea;
		int cant=0;
		while((linea = arch.readLine()) != null) {
			String[] parte = linea.split(",");
			String N_peli = parte[0];
			String tipo = parte[1];
			double Recaudacion = Double.valueOf(parte[2]);
			
			Nombres_peli[cant] = N_peli;
			Tipos[cant] = tipo;
			Recaudaciones[cant] = Recaudacion;
			if(N_peli.equals("Rapidos y Furiosos")) {
				String texto="";
				for(int i=3; i<9;i++) {
					texto +=parte[i]+parte[i+1]+",";
					i++;
				}
				infoPeliculas[cant] = texto;
				
				//salas[1][2] = N_peli+"\t";
				//salas[2][1] = N_peli+"\t";
				//salas[2][2] = N_peli+"\t";
			}else if(N_peli.equals("El conjuro 3")){
				String texto="";
				for(int i=3; i<5;i++) {
					texto +=parte[i]+parte[i+1]+",";
					i++;
				}
				infoPeliculas[cant] = texto;
				//salas[1][1] = N_peli+"\t";
			}else {
				String texto="";
				for(int i=3; i<7;i++) {
					texto +=parte[i]+parte[i+1]+",";
					i++;
				}
				infoPeliculas[cant] = texto;
				//salas[2][3] = N_peli+"\t";
				//salas[1][3] = N_peli+"\t";
			}
			System.out.println(Nombres_peli[cant]);
			System.out.println(cant);
			cant++;
			
		}
		arch.close();
		return cant;
	}
	public static int LeerStatus(String[] Ruts1, String[] Estado) throws IOException {
		BufferedReader arch = new BufferedReader(new FileReader("status.txt"));
		String linea;
		int cant=0;
		while((linea = arch.readLine()) != null) {
			String[] parte = linea.split(",");
			String rut = parte[0];
			rut = convertirRut(rut);
			String estado = parte[1];
			
			Ruts1[cant] = rut;
			Estado[cant] = estado;
			//System.out.println(Estado[cant]);
			cant++;
		}
		arch.close();
		return cant;
	}
	public static Scanner scan = new Scanner(System.in);
	
	public static int leerClientes(String[] Nombres, String[] Apellidos, String[] Ruts, String[] Claves, double[] Saldos, int[] c_Entradas, String[] asientos) throws IOException{
		BufferedReader arch =new BufferedReader(new FileReader("clientes.txt"));
		String linea;
		int cant=0;
		while((linea = arch.readLine()) != null) {
			String[] parte = linea.split(",");
			String nombre = parte[0];
			String apellido = parte[1];
			String rut = parte[2];
			String clave = parte[3];
			double saldo = Double.valueOf(parte[4]);
			rut=convertirRut(rut);
			
			Nombres[cant] = nombre;
			Apellidos[cant] = apellido;
			Ruts[cant] = rut;
			Claves[cant] = clave;
			Saldos[cant] = saldo;
			c_Entradas[cant] = 0;
			asientos[cant] = "";
			//System.out.println(Nombres[cant]);
			cant++;	
			
		}
		arch.close();
		return cant;
	}
}


